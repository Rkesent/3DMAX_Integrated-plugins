# 3ds Max 贴图管理工具 - 开发需求文档

## 开发背景

在多人协作完成模型开发时，会发现在归档文件时出现大量的重复文件，造成大量的资源浪费。在归档集中时处理重复文件的工作需要大量重复操作，既费时又消耗精力，因此开发一个脚本来解决这个问题。

## 功能需求

### 核心功能流程

1. **脚本启动运行**
   - 初始化界面和数据结构
   - 加载必要的库和依赖

2. **从场景文件根目录中实时获取**
   - 扫描场景中的材质和贴图
   - 获取并读取json文件中的贴图信息值
   - 在未获取到json文件时，使用标准获取方式

3. **贴图检测与管理**
   - 获取常规贴图信息（路径、名称等）
   - 计算获取到贴图的哈希值
   - 将贴图名称和原始贴图名显示在列表中

### 授权功能模块

1. **记录功能**
   - 获取场景中贴图的名称、哈希值
   - 将哈希值作为唯一入口与列表关联

2. **撤回功能**
   - 撤回到列表中名称
   - 根据列表中读取的相同哈希值回到当前贴图的名称
   - 更新对应材质库中贴图的索引

3. **全部撤回功能**
   - 将场景中的全部贴图根据规则中的顺序进行回退命名

4. **导入/导出功能**
   - 导入记录值：按照json数据格式导入
   - 对比导入的数据贴图是否存在于场景中使用，如果有则使用相应值
   - 将数据显示在列表中
   - 导出记录值：将列表中记录的数据导出为json文件，默认保存在场景文件根目录下

## 数据格式要求

导出JSON格式示例:
```json
[
  {
    "hash": "哈希值",
    "referenced": "是否引用",
    "original": "image1.png",
    "modified(1)": "new_image1.png"
  },
  {
    "hash": "哈希值",
    "referenced": "否",
    "original": "image2.png",
    "modified(1)": "new_image2.png"
  }
]
```

## 界面需求

### 主界面

1. **主列表区域**
   - 显示所有贴图信息
   - 支持选择和排序功能

2. **信息显示区域**
   - 显示当前选中贴图的详细信息
   - 显示操作日志

3. **功能按钮区域**
   - 检查贴图
   - 替换贴图
   - 更换路径
   - 清除日志

### 高级选项界面

1. **贴图处理选项**
   - 贴图大小检测
   - 贴图归档选项

2. **材质处理选项**
   - 材质批量转换功能
   - 材质命名规则设置

3. **贴图名称历史记录**
   - 查看贴图重命名历史记录
   - 撤销重命名操作

## 性能优化需求

- 大批量文件操作时需要分批处理，添加进度条
- 完善错误处理机制
- 优化内存管理，防止多次操作时处理速度下降
- 多线程处理大量文件的读取和写入操作

## 兼容性需求

- 支持3ds Max 2018及以上版本
- 支持标准材质和VR材质
- 支持多种贴图格式（包括但不限于png, jpg, tga等）
- 支持处理多维子材质

## 预期成果

1. 一个完整的Python脚本文件，可在3ds Max中运行
2. 详细的使用说明文档
3. 代码注释完善，便于后期维护和扩展 